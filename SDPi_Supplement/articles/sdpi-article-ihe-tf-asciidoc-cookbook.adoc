= IHE TF AsciiDoc Cookbook
0.1, 2022.09.06: AsciiDoc article / repo wiki
:doctype: book
:xrefstyle: short
:toc-title: Contents
:toc: left
:toclevels: 2
:sectnums:
:icons: font
:imagesoutdir: images/
:imagesdir: images/

WARNING: This is a straw-man article. Content hackers welcomed!  Add content requests to section <<Topics Parking Lot>> below.

== Cookbook Overview
This article provides a *_handy_* reference place for the conventions and templates that editors will apply in creating content for the SDPi specification.  It is organized so as to help with specific editorial tasks (e.g., references, images, tables, metadata, etc.).

Related articles that support the information below include:

* https://github.com/IHE/sdpi-fhir/blob/50ace3692b9299cdfcea434501df87b192f5220c/SDPi_Supplement/articles/sdpi-article-asciidoc-cheat-sheet.adoc[AsciiDoc Cheat Sheet]
* https://github.com/IHE/sdpi-fhir/wiki/SDPi-File-Organization-Scheme[SDPi File Organization Scheme]

== Asciidoc Source Conventions

The following subsections specify conventions for the writing of Asciidoc markup.
It makes use of [Backus-Naur forms](https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form), which may include
[Regular expressions](https://en.wikipedia.org/wiki/Regular_expression) (signified by enclosing slashes) to describe
grammars for acceptable characters of symbols.

NOTE:  Following sections are in alphabetical order

=== Footnotes

##See example from supplement introduction; note that this example puts the footnotes in the bottom of the table vs. page ... matter?
##

=== Identifier naming

Asciidoc leverages identifiers for cross-referencing artifacts in Asciidoc markup.
The following rule specifies is a general naming convention for identifiers that is used throughout this section:

[source]
----
Name ::= /^[a-z0-9_]+$/
----

Name:: Custom name that contains small letters, digits and underscores only.

==== Blocks

Block Identifiers shall be made up from the following rules:

[source]
----
Volume = 'vol0' | vol1' | 'vol2' | 'vol3'
ReferenceType ::= 'clause' | 'appendix' | 'listing' | 'figure' | 'table'

BlockIdentifier ::= Volume '_' ReferenceType '_' Name
----

Volume:: Target volume.
ReferenceType:: The referenced block type.

.Example of including a clause name
====
[source,asciidoc]
----
[#vol2_clause_transactions]
== Transactions

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore
magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd
gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.
----
====

==== Variables

Variables can be used to avoid repeating names or URIs in the Asciidoc source code. Variables shall be made up from the following rules:

[source]
----
VariableType ::= 'uri'

VariableName ::= 'var_' + [ VariableType + '_' ] + Name
----

VariableType:: Type of the variable, currently URIs/URLs are to be specifically designated.

==== Definitions

Definition Names are just arbitrary character sequences according to the following rule:

[source]
----
DefinitionName ::= Name
----

==== Actors

Actor Names are definition names with a specific prefix:

[source]
----
ActorName ::= 'actor_' + Name
----

=== Image paths

Images are stored in the `images` sub-folder including any diagrams generated by the Asciidoc Diagram plugin.

=== Listing paths

Code listings are stored in the `listings` sub-folder.

=== Nested Tables

##See example in supplement introduction
###

=== Plant UML diagrams

PlantUML diagram sources are stored in the `plantuml` sub-folder.

- A PlantUML diagram source shall be included by using the `include` directive (rather than inline)
- A PlantUML diagram source shall contain `skinparam dpi 300` for appropriate high-resolution rendering
- If no custom color palette is applied on a PlantUML diagram, the PlantUML diagram's source shall contain `skinparam monochrome true` for monochrome rendering

PlantUML diagram target names shall start with `puml` to easily identify any generated Plant UML artifacts in the
`images` folder.

[source]
----
PlantUmlTarget = 'puml-' Name
----

.Example of including a PlantUML diagram. Note the leading `puml-` at the target option.
====
[source,asciidoc]
----
.Diagram title
[[vol2_figure_xyz]]
[plantuml, target=puml-vol2-figure-xyz, format=svg, reftext='{figure-caption} {counter:refnum}']
....
include::../plantuml/vol2-figure-xyz.puml[]
....
----
====

=== Section Numbering Challenges

IHE technical framework _supplement_ documents are intended to be integrated into the main IHE DEV Technical Framework document.  This means that section numbering in the supplement is _discontiguous_ and is based on where it will ultimately be inserted.  AsciiDoc of course does not support discontiguous section numbering and as a result, the content has to be annotated with directions for a post processor (i.e., asciidoc-converter tool) to render the proper section numbering in the HTML output.

==== Setting the Section Offset and Level

##add content here###

==== Appendix Letters

##add content here##

=== Superscript / Subscript

##Bring example from supplement overview using ^...^ and ~...~ respectively
##

=== Text Box for Editor's Instructions
Many of the IHE Technical Framework Supplement sections include instructions for the editor who will ultimately migrate the supplemenbt content into the main (final text) Technical Framework specification.  These instructions are typically contained in a text box at the start of a section.

For AsciiDoc, this text box is realized by defining a one-cell table, as follows:

====
[source,asciidoc]
----
[%noheader]
[%autowidth]
[cols="1"]
|===
|Add the following _*new or modified*_ actors to the IHE Technical Frameworks General Introduction Appendix A
|===
----

This would result in the following text:

[%noheader]
[%autowidth]
[cols="1"]
|===
|Add the following _*new or modified*_ actors to the IHE Technical Frameworks General Introduction Appendix A
|===


== Topics Parking Lot

Include:

Add:  Continuous Build process documentation ... for multi-file / multi-page AsciiDoc sources
* Section Numbering & Naming Conventions
Much of this is specified in the IHE template, but
see "depth" and discontinuous section numbering issues

Capture:  indicate section depth + offset using something like ...

[#the_id,sdpi_num_offset=10] and

[#the_id,sdpi_num_level=+1]  depth indicator

Also factor in Figure and Table numbering:  section number + "-1" | "-2" ...

* Non-section Number Based / cross-doc References



* IHE TF UML Model

Include something that shows the interrelationships between blocks of content.

IMPORTANT: TBD - __Need to determine how to formalize these kinds of UML models; drawn in "Magicdraw", to PNG, to XMl rep of some sort (collapsable inclusion?), used for this doc + for SST database extraction / processing __

* Mapping from UML to AsciiDoc Block Content

** All special blocks should include a UML model for their content and be represented in the general TF UML model
** Classes represent blocks (including referenced classes)
** Class data elements represent block content
** Contained classes represent nested block content that can have cardinality
** ...

* Reference Conventions (basic syntax, conventions)

* Block basics
* Block naming conventions
* Block types

** IHE TF Elements (with URI identifiers) - see UML Models

*** Profile + Profile Option
*** Actor + Actor Option + TF-0 Summary
*** Transaction (TF-0 summary + TF-2 detail)
*** Issues / Open & Closed (w/ ToI links & github Issue links)
*** TF-0 Glossary - Term of Art
*** BICEPS specification (e.g., XML for a specialization OR for a )
*** ...

** RI "link" blocks  (note: separate article proposed ... needed?)
** Requirement blocks
** SES blocks + subsections
** Use Case (Gherkin structured + General Appx. C & profile specific) - see UML model

NOTE:  Include UML model for each block type (per above)

* Block "tagging regions" to omit all from production
** See https://docs.asciidoctor.org/asciidoc/latest/directives/include-tagged-regions/#tagging-regions[AsciiDoc "Tagging regions" article] for conditional logic that can be used to include source content that is not passed through to the printed document
** See https://docs.asciidoctor.org/asciidoc/latest/blocks/delimited/#nesting[AsciiDoc "Nesting blocks" article]

NOTE:  For quick links and examples for AsciiDoc constructs that are used in the SDPi Supplement, see the wiki article:  https://github.com/IHE/sdpi-fhir/wiki/SDPi-Editors-AsciiDoc-Cheat-Sheet.asciidoc[_SDPi Editors' AsciiDoc Cheat Sheet_]

{empty} +

